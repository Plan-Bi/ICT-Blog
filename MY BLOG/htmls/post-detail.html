<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TechBlog | æ–‡ç« è¯¦æƒ…</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- å¼•å…¥å¤œé—´æ¨¡å¼CSS -->
  <link rel="stylesheet" href="../css/dark-mode.css">
  <!-- å¼•å…¥ marked.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body {
      transition: background-color 0.3s, color 0.3s;
    }
    nav {
      background: var(--nav-bg, rgba(255,255,255,0.9));
    }
    .content-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 1.5rem;
    }
    .article-title {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }
    .article-tags {
      font-size: 1rem;
      color: #718096;
      margin-bottom: 1rem;
    }
    .article-content {
      line-height: 1.8;
      font-size: 1.125rem;
      white-space: pre-wrap; /* ä¿ç•™æ¢è¡Œå’Œç©ºæ ¼ */
    }
    .article-date {
      font-size: 0.875rem;
      color: #a0aec0;
      margin-top: 1.5rem;
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-800">
  <!-- å›ºå®šå¯¼èˆªæ  -->
  <nav class="fixed w-full z-50 backdrop-blur">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
      <a href="../index.html" class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-500 bg-clip-text text-transparent">
        CyberLab
      </a>
      <div class="space-x-6">
        <a href="about.html" class="hover:text-blue-500 font-medium">å…³äºæˆ‘</a>
        <a href="posts.html" class="hover:text-blue-500 font-medium">æ–‡ç« </a>
        <a href="activity.html" class="hover:text-blue-500 font-medium">åŠ¨æ€</a>
        <a href="friends.html" class="hover:text-blue-500 font-medium">å‹æƒ…é“¾æ¥</a>
        <button onclick="toggleDarkMode()" class="px-3 py-1 rounded bg-gray-200 dark:bg-gray-700">ğŸŒ“</button>
      </div>
    </div>
  </nav>

  <!-- æ–‡ç« å†…å®¹åŒºåŸŸ -->
  <div class="content-container">
    <!-- è¿”å›æŒ‰é’® -->
    <div class="mb-4">
      <button onclick="goBack()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
        <i class="fas fa-arrow-left mr-2"></i> è¿”å›æ–‡ç« åˆ—è¡¨
      </button>
    </div>
    <div id="articleContent" class="bg-white dark:bg-gray-700 p-8 rounded-lg shadow-lg"></div>
  </div>

  <script>
    // å¤œé—´æ¨¡å¼åˆ‡æ¢
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark-mode');
    }

    // è·å– URL å‚æ•°
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    // è‡ªå®šä¹‰æ¸²æŸ“å™¨
    function getCustomRenderer() {
      const renderer = new marked.Renderer();
      renderer.link = function(href, title, text) {
        if (text.toLowerCase() === 'video') {
          return `<video controls src="${href}" style="max-width:100%;"></video>`;
        } else if (text.toLowerCase() === 'file') {
          return `<a href="${href}" download style="color:blue;">ç‚¹å‡»ä¸‹è½½æ–‡ä»¶</a>`;
        } else {
          return `<a href="${href}" title="${title || ''}">${text}</a>`;
        }
      };
      return renderer;
    }

    // åŠ è½½æ–‡ç« è¯¦æƒ…
    function loadArticle() {
      const id = getQueryParam('id');
      if (!id) {
        document.getElementById('articleContent').innerHTML = '<p>ç¼ºå°‘æ–‡ç«  ID å‚æ•°</p>';
        return;
      }
      const posts = JSON.parse(localStorage.getItem('contents')) || [];
      const article = posts.find(post => post.id == id);
      if (!article) {
        document.getElementById('articleContent').innerHTML = '<p>æœªæ‰¾åˆ°å¯¹åº”æ–‡ç« </p>';
        return;
      }
      // ä½¿ç”¨è‡ªå®šä¹‰æ¸²æŸ“å™¨è§£æ Markdown å†…å®¹
      const renderer = getCustomRenderer();
      const parsedBody = marked.parse(article.body, { renderer: renderer });
      const articleHTML = `
        <h1 class="article-title">${article.title}</h1>
        <div class="article-tags">æ ‡ç­¾ï¼š ${article.tags && article.tags.length > 0 ? article.tags.join(', ') : 'æ— '}</div>
        <div class="article-content">${parsedBody}</div>
        <div class="article-date">å‘å¸ƒäºï¼š ${article.date}</div>
      `;
      document.getElementById('articleContent').innerHTML = articleHTML;

      // è°ƒè¯•ä¿¡æ¯
      console.log('ID:', id);
      console.log('Posts:', posts);
      console.log('Article:', article);
    }

    // è¿”å›ä¸Šä¸€é¡µæˆ–è·³è½¬åˆ°åŠ¨æ€åˆ—è¡¨
    function goBack() {
      if (document.referrer === "" || document.referrer.indexOf("activity-detail.html") !== -1) {
        window.location.href = "activity.html";
      } else {
        window.history.back();
      }
    }

    // è°ƒç”¨åŠ è½½å‡½æ•°
    loadArticle();
  </script>
</body>
</html>
